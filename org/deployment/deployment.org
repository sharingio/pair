#+TITLE: Deployment

* Preparation

Install Helm-Operator:
#+BEGIN_SRC tmate :window pair-setup
helm repo add fluxcd https://charts.fluxcd.io
kubectl apply -f https://raw.githubusercontent.com/fluxcd/helm-operator/1.2.0/deploy/crds.yaml
helm upgrade -i helm-operator --create-namespace fluxcd/helm-operator \
    --namespace helm-operator \
    --set helm.versions=v3
#+END_SRC

(Management with Helm-Operator is recommended but optional)

Create a namespace:
#+begin_src bash :dir ../.././ :results silent
kubectl create ns sharingio-pair
#+end_src

* Installation

A basic installation looks like this:
#+BEGIN_SRC yaml :tangle
apiVersion: helm.fluxcd.io/v1
kind: HelmRelease
metadata:
  name: sharingio-pair
spec:
  releaseName: sharingio-pair
  chart:
    git: https://github.com/sharingio/pair.git
    ref: 1.0.50
    path: charts/sharingio-pair
  values:
    timezone: Pacific/Auckland
    instance:
      kubernetesVersion: 1.21.0
      humacsRepository: registry.gitlab.com/humacs/humacs/ii
      humacsVersion: 2021.05.14
      nodeSize: c1.small.x86
    sessionSecret: pairpairpairpair
    githubOAuth:
      id: my-github-oauth-app-id
      secret: my-github-oauth-app-secret
    equinixMetal:
      projectID: my-equinix-metal-project-id
    ingress:
      enabled: true
      certmanager:
        enabled: true
      hosts:
        - host: pair.sharing.io
          paths:
            - /
#+END_SRC
